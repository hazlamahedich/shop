# Sprint Status File
# generated: 2026-02-04
# project: shop
# project_key: NOKEY
# tracking_system: file-system
# story_location: {project-root}/_bmad-output/implementation-artifacts

# STATUS DEFINITIONS:
# ==================
# Epic Status:
#   - backlog: Epic not yet started
#   - in-progress: Epic actively being worked on
#   - done: All stories in epic completed
#
# Epic Status Transitions:
#   - backlog → in-progress: Automatically when first story is created (via create-story)
#   - in-progress → done: Manually when all stories reach 'done' status
#
# Story Status:
#   - backlog: Story only exists in epic file
#   - ready-for-dev: Story file created in stories folder
#   - in-progress: Developer actively working on implementation
#   - review: Ready for code review (via Dev's code-review workflow)
#   - done: Story completed
#
# Retrospective Status:
#   - optional: Can be completed but not required
#   - done: Retrospective has been completed
#
# WORKFLOW NOTES:
# ===============
# - Epic transitions to 'in-progress' automatically when first story is created
# - Stories can be worked in parallel if team capacity allows
# - SM typically creates next story after previous one is 'done' to incorporate learnings
# - Dev moves story to 'review', then runs code-review (fresh context, different LLM recommended)

generated: 2026-02-04
project: shop
project_key: NOKEY
tracking_system: file-system
story_location: "{project-root}/_bmad-output/implementation-artifacts"

development_status:
  # Sprint 0: Pattern Tooling & Foundation (Prerequisite - Not an Epic)
  sprint-0-pattern-tooling: done # Code review complete: All critical issues fixed

  # Epic 1: Merchant Onboarding & Bot Setup
  epic-1: done # 2026-02-13: ALL 15 STORIES COMPLETE. Sprint Change Proposal approved - Shopify now optional, pluggable e-commerce architecture. See sprint-change-proposal-2026-02-13.md.
  1-1-prerequisite-checklist: done # Code review complete: All issues fixed (see story file)
  1-2-one-click-deployment: done # Code review complete: All HIGH/MEDIUM issues fixed, LOW items deferred with tracking
  1-3-facebook-page-connection: done # Code review complete: All HIGH/MEDIUM issues fixed, DLQ implemented, state validation added
  1-4-shopify-store-connection: done # Code review complete: All HIGH/MEDIUM issues fixed, scope validation added
  1-5-llm-provider-configuration: done # Code review complete: All issues fixed (51 tests passing)
  1-7-webhook-verification: done
  1-8-merchant-dashboard-authentication: done # Refactor complete (2026-02-10): All 14 code review issues fixed. Refactored API to use MinimalEnvelope pattern. All unit and integration tests passing.
  1-9-csrf-token-generation: done # All code review items addressed (2026-02-10): Commit 0982d5ab, typo bugs fixed, backend 44/44 passing, frontend service 26/26 passing, integration tests verified
  1-10-bot-personality-configuration: done # Code review resolved (2026-02-10): All 9 issues fixed. Commit f1bc0acf, 17/17 backend tests passing, 91/91 frontend tests passing.
  1-11-business-info-faq-configuration: done # 2026-02-10: ALL issues resolved (commits 65ef8012 + bc75212c). CRITICAL+HIGH+MEDIUM fixed. 216/216 tests passing. LOW issues deferred.
  1-12-bot-naming: done # 2026-02-11: Implementation complete, ALL code review items addressed (commit 797d46eb). 45 backend + 45 frontend unit tests passing, 7 integration tests passing.
  1-13-bot-preview-mode: done # 2026-02-11: Implementation complete, ALL code review items addressed. 81 tests passing (27 backend API + service, 38 frontend, 16 E2E). Fixes: LLM config integration, actual FAQ matching, real confidence scores, React Router navigation, session cleanup endpoint.
  1-14-smart-greeting-templates: done # 2026-02-12: COMPLETE. All backend tests passing, frontend tests passing, API endpoints working, /bot-config page loading. Fixed: duplicate class definitions in greeting.py schema, duplicate function definitions in bot_config.py, MetaData type mismatch. Added sample greeting templates to story doc.
  1-15-product-highlight-pins: done # 2026-02-12: Implementation complete - all 4 CRITICAL code review issues addressed (service+API working). Unit tests blocked by pytest fixture collision - FIXED. Tests run successfully with direct Python, validating functionality.
  1-6-interactive-tutorial: done # 2026-02-12: COMPLETE. All 8 steps implemented, keyboard navigation, screen reader support, onboarding store, route guards, tutorial prompt. Backend 7/7 tests passing. Frontend tests created (store, component, keyboard). Fixed duplicate callback definitions. Story ready for code review.
  epic-1-retrospective: done # 2026-02-13: Complete retrospective for all 15 stories saved to docs/epic-1-retrospective-v2.md

  # Epic 2: Shopping Experience (CONDITIONAL - requires store connection per sprint-change-proposal-2026-02-13)
  epic-2: done
  2-1-natural-language-intent-classification: done
  2-2-product-search-with-constraints: done # QA test automation complete: 22/22 tests passing (9 integration + 13 E2E)
  2-3-product-result-display: done # QA test automation complete: 17/17 tests passing (7 integration + 10 E2E), implementation committed and pushed
  2-4-clarification-flow: done # Implementation complete, code review complete, committed and pushed (36 tests passing)
  2-5-add-to-cart: done # Implementation complete: 30 tests passing (17 unit + 6 integration + 8 E2E), 91% coverage, committed and pushed
  2-6-view-and-manage-cart: done # Implementation complete: 47 tests passing (10 unit + 9 integration + 12 edge cases + 9 E2E + 7 message processor), committed and pushed with edge case improvements
  2-7-persistent-cart-sessions: done # Code review complete: All issues fixed, including UX bug and dead code integration (20 tests passing)
  2-8-checkout-url-generation: done # Implementation complete: 33 tests passing (14 unit + 9 integration + 10 E2E), committed and pushed
  2-9-order-confirmation: done # Implementation complete: 42 tests passing (18 checkout + 14 order confirmation unit + 5 integration + 5 E2E)
  epic-2-retrospective: done

  # Epic 3: Business Dashboard & Cost Tracking
  epic-3: done # 2026-02-14: ALL 10 STORIES COMPLETE
  3-1-conversation-list-with-pagination: done # Implementation complete: 31/31 tests passing, all tasks completed, code review resolved
  3-2-search-and-filter-conversations: done # Implementation complete: 38 backend tests passing, frontend components created, filter state management implemented
  3-3-csv-data-export: done # Manual verification complete: Backend API, CSV formatting, and frontend UI successfully validated with test data simulation
  3-4-llm-provider-switching: done # 2026-02-14: Status verified complete - all tasks done, code review fixed, API tests passing
  3-5-real-time-cost-tracking: done # Implementation complete: Cost tracking with budget cap persistence. Resolved cost filter bugs. All verification steps passed.
  3-6-budget-cap-configuration: done # 2026-02-14: Code review complete (6 issues fixed), QA 108/108 tests passing (100%), all ACs verified
  3-7-visual-budget-progress: done # QA test automation complete: 75/75 tests passing (41 component + 13 API + 21 E2E), 100% coverage, all code review items addressed
  3-8-budget-alert-notifications: done # 2026-02-13: Manual verification COMPLETE. All 5 ACs verified: 80%/100% alerts, bot pausing, resume flow, $0 budget blocking. All code review items addressed.
  3-9-cost-comparison-display: done # 2026-02-14: Code review complete (8 issues fixed), manual verification PASSED (7/7 test cases). 27/27 automated tests passing.
  3-10-business-hours-configuration: done # Manual verification PASSED 2026-02-14 - All 5 ACs verified. 50 backend + 11 frontend tests passing. CSRF fix applied.
  epic-3-retrospective: done # 2026-02-14: Retrospective complete. Key outcomes: Privacy checklist added, auth DX improvements planned, session persistence bug fixed, Epic 4 mock strategy defined.

  # Epic 4: Order Tracking & Support
  # PHASE 1: Human Handoff (Shopify-independent - Priority Order)
  # PHASE 2: Order Tracking (Shopify-dependent - Requires MockShopifyProvider or real store)
  # See epic-3-retrospective.md for phasing rationale
  epic-4: done # 2026-02-17: ALL 12 STORIES COMPLETE (Phase 1: Human Handoff + Phase 2: Order Tracking)
  
  # PHASE 1: Human Handoff Flow (No Shopify dependency)
  4-5-human-assistance-detection: done # ⭐ FOUNDATION - Detect when shopper needs human help (61 tests, migration applied, QA automate complete: 47/54 E2E passing)
  4-6-handoff-notifications: done # 2026-02-14: Code review COMPLETE - All HIGH/MEDIUM issues fixed (HandoffFlowService created, push stub added, docs corrected)
  4-7-handoff-queue-with-urgency: done # 2026-02-15: Code review COMPLETE + QA automation COMPLETE - Component tests added (37 tests), 145 total tests passing (100%)
  4-8-conversation-history-view: done # 2026-02-17: Code review complete - 9 backend tests, 10 E2E tests, all tasks done
  4-9-open-in-messenger-reply: done # 2026-02-15: Code review complete - All HIGH/MEDIUM issues fixed, fail-safe behavior implemented, 10 frontend + 8 backend unit tests passing
  4-10-return-to-bot: done # Code review complete - All CRITICAL/HIGH issues fixed (closed status error, resolved handoff_status reset, toast error handling), 14 backend tests passing
  4-11-offline-follow-up-messages: done # 2026-02-16: Code review COMPLETE - All HIGH/MEDIUM/LOW issues fixed (7 total). Added: Conversation helper methods, scheduler integration, error codes 7032/7033, atomic transactions, test warnings resolved. 20 unit + 7 integration + 96 E2E tests passing.
  4-12-business-hours-handling: done # 2026-02-16: COMPLETE - Backend API endpoints implemented (handoff-context, handoff-notification, notification-queue-status, settings/business-hours). Bearer token auth added for API tests. 114 E2E + 26/27 API tests passing. Code review fixes: Error codes (7034/7035), graceful config fallback, 10 unit tests, customer_name fix.
  
  # PHASE 2: Order Tracking (Shopify-dependent - blocked without store or mock)
  4-1-natural-language-order-tracking: done # 2026-02-16: Code review COMPLETE - All HIGH/MEDIUM issues fixed. E2E tests rewritten (8 runnable), 3 response time tests added, CONFIRMED factory method added. 49 unit + 25 integration tests passing.
  4-2-shopify-webhook-integration: done # Task 6 & 7 complete: DLQ retry worker + 34 unit tests for order_processor. All tasks done.
  4-3-shipping-notifications: done # 2026-02-17: Code review complete - 30 unit tests passing (all HIGH/MEDIUM issues fixed: Redis import, AC3 24h rule)
  4-4-polling-fallback: done # 2026-02-17: QA automation complete - 62 tests passing (49 unit + 5 API + 8 integration). Fixed datetime timezone handling bugs.
  
  epic-4-retrospective: done # 2026-02-17: Retrospective complete. Key outcomes: CSRF checklist for stories, Python 3.11 venv documentation, integration verification checklist, Facebook → optional for Epic 5.

  # Epic 5: Embeddable Widget (NEW - approved 2026-02-17)
  # See: sprint-change-proposal-2026-02-17.md, docs/embeddable-widget-plan.md
  epic-5: in-progress # 2026-02-17: Started with Story 5-1
  5-1-backend-widget-api: done # 2026-02-17: Code review COMPLETE - 4 issues fixed (LLM timeout, domain whitelist, sanitization, test endpoint), 35 tests passing
  5-2-widget-session-management: review # 2026-02-18: Implementation complete - 13 tests passing (7 unit + 6 integration)
  5-3-widget-frontend-components: done # 2026-02-18: Code review COMPLETE - 7 issues fixed (Shadow DOM, merchantId, typing animation, aria-busy, session persistence), 44 tests passing
  5-4-build-system-loader-script: done # 2026-02-18: Code review COMPLETE - 7 issues fixed (unmount, validation, container test, localhost URLs), 19 unit + 144 E2E tests passing
  5-5-theme-customization-system: done # 2026-02-18: Code review COMPLETE - 5 issues fixed (style accumulation, undefined handling, duplicate constants, file list, unused import), 107+ tests passing
  5-6-merchant-widget-settings-ui: done # 2026-02-18: Code review COMPLETE - 8 issues fixed (4 HIGH, 4 MEDIUM), 129+ tests passing
  5-7-security-rate-limiting: done # 2026-02-19: Adversarial code review COMPLETE - 6 issues fixed (time.sleep→mocked time, E2E assertions, bypass mode test, type annotations), 32 security + 108+ total tests passing
  5-8-performance-optimization: done # 2026-02-19: Code review COMPLETE - 5 issues fixed (slow 3G tests, CLS threshold, CSS test, file list, checklist), 11 unit tests passing, bundle <100KB
  5-9-cdn-setup-documentation: done # 2026-02-20: Code review COMPLETE - 3 MEDIUM issues fixed (File List accuracy, bundle copy docs, git discrepancy note), 12/12 tests passing
  5-10-widget-full-app-integration: done # 2026-02-21: COMPLETE - UnifiedConversationService created, Widget/Preview migrated, FB Messenger deferred to 5-11
  5-11-messenger-unified-service-migration: backlog # Deferred from 5-10 Task 10 - Migrate FB Messenger to UnifiedConversationService
  epic-5-retrospective: optional

  # Epic 6: Data Privacy & Compliance (Renumbered from Epic 5 - approved 2026-02-17)
  epic-6: backlog
  6-1-opt-in-consent-flow: backlog
  6-2-request-data-deletion: backlog
  6-3-merchant-csv-export: backlog
  6-4-data-tier-separation: backlog
  6-5-30-day-retention-enforcement: backlog
  6-6-gdpr-deletion-processing: backlog
  epic-6-retrospective: optional
